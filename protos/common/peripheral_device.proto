syntax = "proto3";

package cloud.lazycat.apis.common;

option go_package = "gitee.com/linakesi/lzc-sdk/lang/go/common";

import "common/security_context.proto";
import "google/protobuf/empty.proto";

// 外围设备管理服务
service PeripheralDeviceService {
  // 列举当前盒子所连接的移动磁盘。以及对应磁盘在当前APP中的挂载情况。
  // 挂载情况应该反应当下的实际情况。
  rpc ListRemovableDisk(google.protobuf.Empty) returns (ListRemovableDiskReply) {}

  // 挂载/卸载特定移动磁盘的某个分区到 $APPID/lzcapp/run/mnt/media/$partion_uuid目录下
  rpc MountFilesystem(MountFilesystemRequest) returns (google.protobuf.Empty) {
    option (cloud.lazycat.apis.common.scontext).require_permissions = USER_DOCUMENT;
  }

  rpc UmountFilesystem(UmountFilesystemRequest) returns (google.protobuf.Empty) {}

  rpc MountWebDav(MountWebDavRequest) returns (google.protobuf.Empty) {}
}

message ListRemovableDiskReply {
  //当前APP未挂载的磁盘列表
  repeated RemovableFilesystemPartition umounted = 1;

  //当前APP已挂载的磁盘列表。
  repeated RemovableFilesystemPartition mounted = 2;
}

message RemovableFilesystemPartition {
  string source = 1;

  // ntfs/fat32/ext4 ...
  string fstype = 2;

  // partion label name or other meaningful name for user(eg. sda)
  string name = 3;

  // size unit in bytes
  uint64 size = 4;

  // uuid of filesystem, maybe nil(eg. for fuse)
  optional string uuid = 5;

  // mountpoint of filesystem, nil if it's not mounted
  optional string mountpoint = 6;
}

message MountFilesystemRequest {
  string uuid = 1;
}

message UmountFilesystemRequest {
  oneof target {
    string uuid = 1;
    string mountpoint = 2;
  }
}

message MountWebDavRequest {
  string url = 1;
  // relative to webdav home root
  string mountpoint = 2;
  string username = 3;
  string password = 4;
}
