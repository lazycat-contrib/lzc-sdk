syntax = "proto3";

package cloud.lazycat.apis.common;


option go_package = "gitee.com/linakesi/lzc-sdk/lang/go/common";
import "google/protobuf/empty.proto";

service FileHandler {
  rpc query(QueryRequest) returns (QueryReply) {}
  rpc open(OpenRequest) returns (OpenReply) {}
  rpc openFileManager(OpenFileManagerRequest) returns (google.protobuf.Empty) {}
  // 列出目录结构
  rpc walkDirectory(WalkDirectoryRequest) returns (stream WalkDirectoryReply) {}
}

message WalkDirectoryRequest {
  // 目录路径
  string path = 1;
  // 过滤条件
  optional string pattern = 2;
  // 并行线程数，不传或<=0的话，就等于$ nproc
  optional int32 worker_count = 3;
}

// 每Walk 1000个entry后返回一次reply
message WalkDirectoryReply {
  // 每一个目录中的内容
  message Entry {
    // 全路径 /home/lnks/hello.txt
    string path = 1;
    // 文件名 hello.txt
    string base = 2;
    // 文件大小
    int64 size = 3;
    // 是否为目录
    bool dirp = 4;
  }
  repeated Entry result = 1;
}

message OpenFileManagerRequest{
  // 文件(夹)路径
  string path = 1;
}

message OpenRequest {
  // 应用id
  string app_id = 1;
  // 文件路径
  string path = 2;
}

message OpenReply {
  // 打开应用的地址
  optional string url = 1;
}

message QueryRequest {
  // 文件mime类型
  string mime = 1;
  // 文件路径(可选 android下面使用path查询，体验更好 ）
  optional string path = 2;
  // 期望的 app icon 尺寸(宽高一致）
  optional int32 icon_size = 3;
}
message QueryReply {
  repeated AppShortcut app_list = 1;
}

message AppShortcut{
  string app_id = 1;
  string title = 2;
  string icon = 3;
}
