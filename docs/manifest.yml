lzc-sdk-version: 0.1  #决定了manifest文件格式以及/usr/bin/lzcinit的版本

package: abc.example.com #app的唯一标识符
version: 2.0.2           #app的版本

name: 测试abc
description: 简单易用的英语学习软件

license: https://choosealicense.com/licenses/mit/
homepage: http://github.com/snyh/abc #出现bug时候提交反馈的地方
author: snyh@snyh.org

permissions: #静态权限列表, 还在设计中，方向是权限定义以及权限要求都在protos文件中定义，然后扫描proto文件生成规则列表嵌入到api-server中
  - CLOUD.LAZYCAT.APIS.USER_DOCUMENT
  - CLOUD.LAZYCAT.APIS.END_DEVICES

#application作为一个特殊的container运行，对应的service名称为固定的`app`，其他service可以通过此名称与app进行通讯
application:
  subdomain: abc  #期望的app域名，如果系统中已经有对应域名则会提示用户选择其他域名。最终app分配到的域名以/lzcapp/run/app.subdomain为准

  workdir: /lzcapp/pkg/content/ #设置lzcinit以及后续子进程的WORKDIR,若不设置或目录不存在则保持使用container的WORKDIR信息

  public_path: /api/public  #默认情况下所有路径都需要登陆后才能访问，public_path之下的路径允许非登陆情况下访问

  background_task: false #是否存在后台任务，若存在则系统不会对此app进行主动休眠等操作

  file_handler: # 声明本app支持操作的文件类型，mime至少存在一条记录，actions至少要支持open
    mime:  #按照mime类型注册到系统
      - x-scheme-handler/http
      - x-scheme-handler/https
      - text/html
      - application/xhtml+xml
      - x-lzc-extension/km      # app支持.km文件名后缀
    actions:  #打开对应文件的url路径,由文件管理器等app调用
      open: /open?file=%u   #%u是某个webdav上的具体文件路径，一定存在
      new:  /open?file=%u   #%u是某个webdav上的具体文件路径，不一定存在

  routes:
    - /api/=exec://8000,/lzcapp/pkg/content/bin/backend     #格式与/usr/bin/lzcinit -up参数一致
    - /=file:///lzcapp/pkg/content/dist/

  handlers:
    acl_handler: http://127.0.0.1:1234/acl #app对于浏览器发起的behalf_of_uid的过滤，如果acl通过则会传递到lzc api services否则403

    # 当routes中https/http/exec类型的反代出现错误时，则渲染对应模板。
    # 若错误类型为无法返回任何数据，则会生成一个502响应，比如上游游服务器不存在或网络不通等完全获取不到一个http response的情况。
    #
    # 其他情况则根据http response status code，选择对应的模板
    # 若命中错误处理页面, 则http response status code本身不会进行修改
    #
    # 页面渲染使用此数据结构
      # struct {
      #    StatusCode int
      #    ErrorDetail string #无法获取http response的情况下，此字段会显示对应错误信息，并将StatusCode设置为502
      # }
    error_page_templates:
      502: /lzcapp/pkg/content/errors/502.html.tpl
      404: /lzcapp/pkg/content/errors/404.html.tpl

  ingress:
    - protocol: tcp  #tcp or udp
      port: 22       #需要曝露的端口号
      service: db    #为空则为此app容器内的端口,也可以指定为db等其他service的名称

  image: alpine:3.16  #可选的运行环境，为空则使用sdk对应版本的镜像。若上架到商店，则此处的镜像必须上传到商店仓库统一托管。

  depends_on: db


services: #传统docker镜像启动方式，如果需要数据库等配套容器一起运行则可以在这里申明。传统app如nextcloud、aria2c也可以使用这种方式进行兼容运行
  db: #目前只支持以下参数，network,ipc之类的配置字段(故意)不支持
    image: bitnami/wordpress:5.8.2
    environment:
      - ALLOW_EMPTY_PASSWORD=yes
    # 仅支持以/lzcapp开头的挂载点，且遵循仅var,tmp,cache等目录可写的原则。
    # 其中 /lzcapp/var 和 /lzcapp/cache 目录，每个 service 之间互相不可见
    binds:
      - /lzcapp/var/db/:/data
      - /lzcapp/cache/db:/cache/
    entrypoint: /bin/sh -c
    command: "/usr/bin/nextcloud"
    #depends_on:
