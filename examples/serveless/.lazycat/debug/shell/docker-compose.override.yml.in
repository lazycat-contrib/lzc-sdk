services:
  ${APP_ID}:
    image: nginx:1.21.4-alpine
    volumes:
      - ./nginx.conf.template:/etc/nginx/templates/nginx.conf.template
      - ./50x.html:/etc/nginx/50x.html
    environment:
      - NGINX_ENVSUBST_OUTPUT_DIR=/etc/nginx
      - APP_DEBUG_PORT=${HTTP_SERVICE_PORT}
      - APP_DEBUG_SHELL=debug-shell.${APP_ID}.lzcapp
    command: [nginx, '-g', 'daemon off;']
    depends_on:
      - debug-shell
  debug-shell:
    image: ${APP_IMAGE_NAME}
    pull_policy: build
    build: .
    volumes:
      - ./debug/ssh:/root/.ssh
      - project-data:/root/

volumes:
  project-data:
